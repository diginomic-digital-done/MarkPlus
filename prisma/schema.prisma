generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Replace with your database provider (e.g., mysql, sqlite, etc.)
  url      = env("DATABASE_URL") 
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model User {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String
  email     String   @unique
  password  String
  mobile    String
  state     String
  roleId    Int
  role      Role     @relation(fields: [roleId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  pdfRequests PDFRequest[]
}

model State {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  code        String   @unique
  isActive    Boolean  @default(true)
  pdfRequests PDFRequest[]
  regions     Region[]
}

model Region {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  code      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  stateId   Int
  state     State    @relation(fields: [stateId], references: [id])
  floorPlans FloorPlan[]
  pdfStaticPages String[] // Ordered list of static PDF page file URLs/paths
  pdfRequests PDFRequest[]
}

model FloorPlan {
  id              Int      @id @default(autoincrement())
  title           String
  regionId        Int
  region          Region   @relation(fields: [regionId], references: [id])
  frontage        Float?
  areaLiving      Int?
  areaTotal       Int?
  basePrice       Float
  bedrooms        Int?
  bathrooms       Int?
  carSpaces       Int?
  heroImage       String?
  gallery         String[]
  brochurePdf     String?
  floorPlanUrl    String?
  status          String
  pdfPagesOverride String[]
  variationOptions VariationOption[]
  pdfRequests PDFRequest[]
}


model VariationType {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  label       String
  isActive    Boolean  @default(true)
  variationOptions VariationOption[]
}

model VariationOption {
  id          Int      @id @default(autoincrement())
  floorPlanId Int
  floorPlan   FloorPlan @relation(fields: [floorPlanId], references: [id])
  variationTypeId Int
  variationType VariationType @relation(fields: [variationTypeId], references: [id])
  label       String
  description String?
  image       String?
  staffImage  String?
  icon        String? // icon/image for frontend display
  priceDelta  Float?
  staffPriceDelta Float?
  isActive    Boolean  @default(true)
  order       Int?
}

enum TriggeredBy {
  USER
  STAFF
  SYSTEM
}

model PDFRequest {
  id              String   @id @default(uuid())
  triggeredBy     TriggeredBy
  userId          Int?
  user            User?    @relation(fields: [userId], references: [id])
  stateId         Int
  state           State    @relation(fields: [stateId], references: [id])
  regionId        Int
  region          Region   @relation(fields: [regionId], references: [id])
  floorPlanId     Int
  floorPlan       FloorPlan @relation(fields: [floorPlanId], references: [id])
  selectedOptions Json
  clientFirstName String
  clientEmail     String
  clientPhone     String
  longCode        String
  sourceUrl       String?
  createdAt       DateTime @default(now())
}